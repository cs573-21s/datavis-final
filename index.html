<!DOCTYPE html>
<html>
<head>
    <title>CS573 Final Project</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="js/touche-min.js" charset="utf-8"></script>
    <script src="js/zepto.min.js" charset="utf-8"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="page active" data-page="home">
        <div class="comparison_top">
            <div class="title">
                <h1>WORLD HAPPINESS REPORT COMPARISON TOOL</h1>
            </div>
            <div class="switch_vis_button">
                <button class="type_button" id="bar_graph_button"></button>
                <button class="type_button active" id="radar_chart_button"></button>
            </div>
            <button class="type_button" id="compare_toggle_button"></button>
            
        </div>

        <div class="comparison_bottom">
            <button id="info_button" data-js-page="info"></button>
        </div>

        <div class="comparison_ui">
            <div class="left">
                <div class="country_list">
                    <h2 id='left_add_country' data-js-page="left_selection">COUNTRIES +</h2>
                    <div id="left_countries">

                    </div>
                </div>
            </div>

            <div class="middle">
                <div class="middle_left">
                    <h3>AVERAGE SCORE</h3>
                    <div class="score">ADD<br>COUNTRIES</div>
                    <div id="left_vis">

                    </div>
                </div>
                <div id="middle_vis">

                </div>
                <div class="middle_right">
                    <h3>AVERAGE SCORE</h3>
                    <div class="score">ADD<br>COUNTRIES</div>
                    <div id="right_vis">
                        
                    </div>
                </div>
            </div>
            
            <div class="right">
                <div class="country_list">
                    <h2 id="right_add_country" data-js-page="right_selection">+ COUNTRIES</h2>
                    <div id="right_countries">
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="page" data-page="right_selection">
        <div class="selection_ui">
            <div class="top">
                <div></div>
                <div class="title">
                    <h1>TOGGLE COUNTRIES/GROUPS</h1>
                </div>
                <button id="exit_button" data-js-page="home"></button>
            </div>
            <div class="body">
                <div class="left">
                    <div class="entities">
                        <h2>PRE-DEFINED GROUPS</h2>
                        <div class="countries_groups" id="predefined_groups">
                        </div>
    
                        <h2>CONTINENTS</h2>
                        <div class="countries_groups" id="continents">
                        </div>
    
                        <h2>NORTH AMERICA</h2>
                        <div class="countries_groups" id="north_america">
                        </div>
    
                        <h2>SOUTH AMERICA</h2>
                        <div class="countries_groups" id="south_america">
                        </div>
    
                        <h2>ASIA</h2>
                        <div class="countries_groups" id="asia">
                        </div>
    
                        <h2>EUROPE</h2>
                        <div class="countries_groups" id="europe">
                        </div>

                        <h2>AFRICA</h2>
                        <div class="countries_groups" id="africa">    
                        </div>
    
                        <h2>OCEANIA</h2>
                        <div class="countries_groups" id="oceania">                            
                        </div>
                    </div>
                </div>
                
                <div class="right">
                    <div class="rank">
                        <h2>RANK</h2>
                        <div class="list">
                        </div>
                    </div>
                </div>
            </div>  
        </div>
    </div>

    <div class="page" data-page="left_selection">
        <div class="selection_ui">
            <div class="top">
                <button id="exit_button" data-js-page="home"></button>
                <div class="title">
                    <h1>TOGGLE COUNTRIES/GROUPS</h1>
                </div>
                <div></div>
            </div>
            <div class="body">
                <div class="left">
                    <div class="entities">
                        <h2>PRE-DEFINED GROUPS</h2>
                        <div class="countries_groups" id="predefined_groups">
                        </div>
    
                        <h2>CONTINENTS</h2>
                        <div class="countries_groups" id="continents">
                        </div>
    
                        <h2>NORTH AMERICA</h2>
                        <div class="countries_groups" id="north_america">
                        </div>
    
                        <h2>SOUTH AMERICA</h2>
                        <div class="countries_groups" id="south_america">
                        </div>
    
                        <h2>ASIA</h2>
                        <div class="countries_groups" id="asia">
                        </div>
    
                        <h2>EUROPE</h2>
                        <div class="countries_groups" id="europe">
                        </div>

                        <h2>AFRICA</h2>
                        <div class="countries_groups" id="africa">    
                        </div>
    
                        <h2>OCEANIA</h2>
                        <div class="countries_groups" id="oceania">                            
                        </div>
                    </div>
                </div>
                
                <div class="right">
                    <div class="rank">
                        <h2>RANK</h2>
                        <div class="list">
                        </div>
                    </div>
                </div>
            </div>  
        </div>
    </div>

    <div class="page" data-page="info">
        <div class="info_ui">
            <div class="top">
                <button id="exit_button" data-js-page="home"></button>
                <div class="title">
                    <h1>PROJECT INFO</h1>
                </div>
                <button id="exit_button" data-js-page="home"></button>
            </div>
            <div class="body">
                <div class="text_body">
                    <h2>DESCRIPTION</h2>
                    <p>fhdjkfjdsajdsakfjdksalfd
                        safasdfsdfsdjfklsdjfsdjfklsd
                    </p>

                </div>
                <div class="text_body">
                    <h2>FINDINGS</h2>
                    <p>fhdjkfjdsajdsakfjdksalfd
                        safasdfsdfsdjfklsdjfsdjfklsd
                    </p>
                    <p>fhdjkfjdsajdsakfjdksalfd
                        safasdfsdfsdjfklsdjfsdjfklsd
                    </p>
                </div>
                <div class="text_body">
                    <h2>HOW TO USE</h2>    
                    <p>fhdjkfjdsajdsakfjdksalfd
                        safasdfsdfsdjfklsdjfsdjfklsd
                    </p>
                    <p>fhdjkfjdsajdsakfjdksalfd
                        safasdfsdfsdjfklsdjfsdjfklsd
                    </p>
                </div>
                
            </div>  
        </div>
    </div>

    <script>
        // - - - - - - - - - COUNTRY GROUP PRESETS - - - - - - - - - 
        var countriesNorthAmerica = ['Canada', 'Costa Rica', 'United States', 'Mexico', 'Guatemala', 'Panama', 'El Salvador', 'Trinidad & Tobago', 'Nicaragua', 'Jamaica', 'Honduras', 'Dominican Republic', 'Haiti'].sort();
        var countriesSouthAmerica = ['Brazil', 'Chile', 'Uruguay', 'Colombia', 'Argentina', 'Ecuador', 'Bolivia', 'Paraguay', 'Peru', 'Venezuela'].sort();
        var countriesEurope = ['Finland', 'Denmark', 'Norway', 'Iceland', 'Netherlands', 'Switzerland', 'Sweden', 'Austria', 'Luxembourg', 'United Kingdom', 'Ireland', 'Germany', 'Belgium', 'Czech Republic', 'Malta', 'France', 'Spain', 'Italy', 'Slovakia', 'Poland', 'Lithuania', 'Slovenia', 'Kosovo', 'Romania', 'Cyprus', 'Latvia', 'Estonia', 'Hungary', 'Northern Cyprus', 'Portugal', 'Russia', 'Serbia', 'Moldova', 'Montenegro', 'Croatia', 'Bosnia and Herzegovina', 'Belarus', 'Greece', 'North Macedonia', 'Bulgaria', 'Albania', 'Ukraine'].sort();
        var predefinedGroups = ['Top 50','Bottom 50','Developed','Developing','Transitioning', 'World']
        var continents = ['North America','South America', 'Asia', 'Europe', 'Africa', 'Oceania']
        var countriesAsia = ['Israel', 'United Arab Emirates', 'Taiwan', 'Saudi Arabia', 'Qatar', 'Singapore', 'Bahrain', 'Uzbekistan', 'Kuwait', 'Thailand', 'South Korea', 'Japan', 'Kazakhstan', 'Pakistan', 'Philippines', 'Tajikistan', 'Hong Kong', 'Turkey', 'Malaysia', 'Mongolia', 'Kyrgyzstan', 'Turkmenistan', 'Azerbaijan', 'Lebanon', 'Indonesia', 'China', 'Vietnam', 'Bhutan', 'Nepal', 'Jordan', 'Laos', 'Cambodia', 'Palestinian Territories', 'Armenia', 'Iran', 'Georgia', 'Bangladesh', 'Iraq', 'Sri Lanka', 'Myanmar', 'India', 'Syria', 'Yemen', 'Afghanistan'].sort();
        var countriesAfrica = ['Mauritius', 'Libya', 'Nigeria', 'Algeria', 'Morocco', 'Cameroon', 'Ghana', 'Ivory Coast', 'Benin', 'Congo (Brazzaville)', 'Gabon', 'South Africa', 'Senegal', 'Somalia', 'Namibia', 'Niger', 'Burkina Faso', 'Guinea', 'Gambia', 'Kenya', 'Mauritania', 'Tunisia', 'Congo (Kinshasa)', 'Mali', 'Sierra Leone', 'Chad', 'Ethiopia', 'Swaziland', 'Uganda', 'Egypt', 'Zambia', 'Togo', 'Liberia', 'Comoros', 'Madagascar', 'Lesotho', 'Burundi', 'Zimbabwe', 'Botswana', 'Malawi', 'Rwanda', 'Tanzania', 'Central African Republic', 'South Sudan'].sort();
        var countriesOceania = ['New Zealand', 'Australia'].sort();
        var countriesDeveloped = ['Finland', 'Denmark', 'Norway', 'Iceland', 'Netherlands', 'Switzerland', 'Sweden', 'New Zealand', 'Canada', 'Australia', 'Austria', 'Luxembourg', 'United Kingdom', 'Ireland', 'Germany', 'Belgium', 'United States', 'Czech Republic', 'Malta', 'France', 'Spain', 'Italy', 'Slovakia', 'Poland', 'Lithuania', 'Slovenia', 'Romania', 'Cyprus', 'Latvia', 'Estonia', 'Japan', 'Hungary', 'Portugal', 'Croatia', 'Greece', 'Bulgaria'];
        var countriesTransition = ['Uzbekistan', 'Kazakhstan', 'Russia', 'Serbia', 'Moldova', 'Montenegro', 'Tajikistan', 'Bosnia and Herzegovina', 'Belarus', 'North Macedonia', 'Kyrgyzstan', 'Turkmenistan', 'Azerbaijan', 'Albania', 'Armenia', 'Georgia', 'Ukraine'];
        var countriesDeveloping = ['Costa Rica', 'Israel', 'United Arab Emirates', 'Mexico', 'Taiwan', 'Chile', 'Guatemala', 'Saudi Arabia', 'Qatar', 'Panama', 'Brazil', 'Uruguay', 'Singapore', 'El Salvador', 'Bahrain', 'Trinidad & Tobago', 'Colombia', 'Nicaragua', 'Kosovo', 'Argentina', 'Ecuador', 'Kuwait', 'Thailand', 'South Korea', 'Jamaica', 'Mauritius', 'Honduras', 'Bolivia', 'Paraguay', 'Northern Cyprus', 'Peru', 'Pakistan', 'Philippines', 'Libya', 'Hong Kong', 'Dominican Republic', 'Turkey', 'Malaysia', 'Mongolia', 'Nigeria', 'Algeria', 'Morocco', 'Lebanon', 'Indonesia', 'China', 'Vietnam', 'Bhutan', 'Cameroon', 'Ghana', 'Ivory Coast', 
            'Nepal', 'Jordan', 'Benin', 'Congo (Brazzaville)', 'Gabon', 'Laos', 'South Africa', 'Venezuela', 'Cambodia', 'Palestinian Territories', 'Senegal', 'Somalia', 'Namibia', 'Niger', 'Burkina Faso', 'Iran', 'Guinea', 'Gambia', 'Kenya', 'Mauritania', 'Mozambique', 'Tunisia', 'Bangladesh', 'Bangladesh', 'Iraq', 'Congo (Kinshasa)', 'Mali', 'Sierra Leone', 'Sri Lanka', 'Myanmar', 'Chad', 'Ethiopia', 'Swaziland', 'Uganda', 'Egypt', 'Zambia', 'Togo', 'India', 'Liberia', 'Comoros', 'Madagascar', 'Lesotho', 'Burundi', 'Zimbabwe', 'Haiti', 'Botswana', 'Syria', 'Malawi', 'Yemen', 'Rwanda', 'Tanzania', 'Afghanistan', 'Central African Republic', 'South Sudan'];
        var countriesTop50 = ['Finland', 'Denmark', 'Norway', 'Iceland', 'Netherlands', 'Switzerland', 'Sweden', 'New Zealand', 'Canada', 'Austria', 'Australia', 'Costa Rica', 'Israel', 'Luxembourg', 'United Kingdom', 'Ireland', 'Germany', 'Belgium', 'United States', 'Czech Republic', 'United Arab Emirates', 'Malta', 'Mexico', 'France', 'Taiwan', 'Chile', 'Guatemala', 'Saudi Arabia', 'Qatar', 'Spain', 'Panama', 'Brazil', 'Uruguay', 'Singapore', 'El Salvador', 'Italy', 'Bahrain', 'Slovakia', 'Trinidad & Tobago', 'Poland', 'Uzbekistan', 'Lithuania', 'Colombia', 'Slovenia', 'Nicaragua', 'Kosovo', 'Argentina', 'Romania', 'Cyprus', 'Ecuador'];
        var countriesBottom50 = ['Albania', 'Venezuela', 'Cambodia', 'Palestinian Territories', 'Senegal', 'Somalia', 'Namibia', 'Niger', 'Burkina Faso', 'Armenia', 'Iran', 'Guinea', 'Georgia', 'Gambia', 'Kenya', 'Mauritania', 'Mozambique', 'Tunisia', 'Bangladesh', 'Iraq', 'Congo (Kinshasa)', 'Mali', 'Sierra Leone', 'Sri Lanka', 'Myanmar', 'Chad', 'Ukraine', 'Ethiopia', 'Swaziland', 'Uganda', 'Egypt', 'Zambia', 'Togo', 'India', 'Liberia', 'Comoros', 'Madagascar', 'Lesotho', 'Burundi', 'Zimbabwe', 'Haiti', 'Botswana', 'Syria', 'Malawi', 'Yemen', 'Rwanda', 'Tanzania', 'Afghanistan', 'Central African Republic', 'South Sudan'];
        var countriesListRank = ['Finland', 'Denmark', 'Norway', 'Iceland', 'Netherlands', 'Switzerland', 'Sweden', 'New Zealand', 'Canada', 'Austria', 'Australia', 'Costa Rica', 'Israel', 'Luxembourg', 'United Kingdom', 'Ireland', 'Germany', 'Belgium', 'United States', 'Czech Republic', 'United Arab Emirates', 'Malta', 'Mexico', 'France', 'Taiwan', 'Chile', 'Guatemala', 'Saudi Arabia', 'Qatar', 'Spain', 'Panama', 'Brazil', 'Uruguay', 'Singapore', 'El Salvador', 'Italy', 'Bahrain', 'Slovakia', 'Trinidad & Tobago', 'Poland', 'Uzbekistan', 'Lithuania', 'Colombia', 'Slovenia', 'Nicaragua', 'Kosovo', 'Argentina', 'Romania', 'Cyprus', 'Ecuador','Kuwait','Thailand','Latvia','South Korea','Estonia','Jamaica','Mauritius','Japan','Honduras','Kazakhstan','Bolivia','Hungary','Paraguay','Northern Cyprus','Peru','Portugal','Pakistan','Russia','Philippines','Serbia','Moldova','Libya','Montenegro','Tajikistan','Croatia','Hong Kong','Dominican Republic','Bosnia and Herzegovina','Turkey','Malaysia','Belarus','Greece','Mongolia','North Macedonia','Nigeria','Kyrgyzstan','Turkmenistan','Algeria','Morocco','Azerbaijan','Lebanon','Indonesia','China','Vietnam','Bhutan','Bhutan','Cameroon','Bulgaria','Ghana','Ivory Coast','Nepal','Jordan','Benin','Congo (Brazzaville)','Gabon','Laos','South Africa','Albania', 'Venezuela', 'Cambodia', 'Palestinian Territories', 'Senegal', 'Somalia', 'Namibia', 'Niger', 'Burkina Faso', 'Armenia', 'Iran', 'Guinea', 'Georgia', 'Gambia', 'Kenya', 'Mauritania', 'Mozambique', 'Tunisia', 'Bangladesh', 'Iraq', 'Congo (Kinshasa)', 'Mali', 'Sierra Leone', 'Sri Lanka', 'Myanmar', 'Chad', 'Ukraine', 'Ethiopia', 'Swaziland', 'Uganda', 'Egypt', 'Zambia', 'Togo', 'India', 'Liberia', 'Comoros', 'Madagascar', 'Lesotho', 'Burundi', 'Zimbabwe', 'Haiti', 'Botswana', 'Syria', 'Malawi', 'Yemen', 'Rwanda', 'Tanzania', 'Afghanistan', 'Central African Republic', 'South Sudan'];

        // - - - - - - - - - SIDE ARRAYS - - - - - - - - - - - - - 
        var leftCountries = [];
        var rightCountries = [];
        var selectionSide = null; // left or right
        var visType = 'radar'; // bar or radar
        var comparisonType = 'separate'; // separate or together

        console.log(d3); // test if d3 is loaded

        // tooltip
        var tooltip = d3.select("body").append("div")
            .attr("class", "tooltip-point")
            .style("opacity", 0);

        //Graphs made in csv load because it is asynchronous
        d3.csv("2019data.csv", function(data) {
            // set up selection screen
            for (i=0;i<countriesListRank.length;i++) {
                $(".page[data-page='right_selection'] .list").append("<div class='list_item'><h3>"+(i+1).toString()+"</h3><button class='toggle'>"+countriesListRank[i]+"</button></div>")
                $(".page[data-page='left_selection'] .list").append("<div class='list_item'><h3>"+(i+1).toString()+"</h3><button class='toggle'>"+countriesListRank[i]+"</button></div>")
            } 

            for (i=0;i<countriesNorthAmerica.length;i++) {
                $(".page[data-page='right_selection'] #north_america").append("<button class='toggle'>"+countriesNorthAmerica[i]+"</button>");
                $(".page[data-page='left_selection'] #north_america").append("<button class='toggle'>"+countriesNorthAmerica[i]+"</button>");
            } 

            for (i=0;i<countriesSouthAmerica.length;i++) {
                $(".page[data-page='right_selection'] #south_america").append("<button class='toggle'>"+countriesSouthAmerica[i]+"</button>");
                $(".page[data-page='left_selection'] #south_america").append("<button class='toggle'>"+countriesSouthAmerica[i]+"</button>");
            } 

            for (i=0;i<countriesAsia.length;i++) {
                $(".page[data-page='right_selection'] #asia").append("<button class='toggle'>"+countriesAsia[i]+"</button>");
                $(".page[data-page='left_selection'] #asia").append("<button class='toggle'>"+countriesAsia[i]+"</button>");
            } 

            for (i=0;i<countriesAfrica.length;i++) {
                $(".page[data-page='right_selection'] #africa").append("<button class='toggle'>"+countriesAfrica[i]+"</button>");
                $(".page[data-page='left_selection'] #africa").append("<button class='toggle'>"+countriesAfrica[i]+"</button>");
            } 

            for (i=0;i<countriesOceania.length;i++) {
                $(".page[data-page='right_selection'] #oceania").append("<button class='toggle'>"+countriesOceania[i]+"</button>");
                $(".page[data-page='left_selection'] #oceania").append("<button class='toggle'>"+countriesOceania[i]+"</button>");
            } 

            for (i=0;i<countriesEurope.length;i++) {
                $(".page[data-page='right_selection'] #europe").append("<button class='toggle'>"+countriesEurope[i]+"</button>");
                $(".page[data-page='left_selection'] #europe").append("<button class='toggle'>"+countriesEurope[i]+"</button>");
            } 

            for (i=0;i<continents.length;i++) {
                $(".page[data-page='right_selection'] #continents").append("<button class='toggle'>"+continents[i]+"</button>");
                $(".page[data-page='left_selection'] #continents").append("<button class='toggle'>"+continents[i]+"</button>");
            } 

            for (i=0;i<predefinedGroups.length;i++) {
                $(".page[data-page='right_selection'] #predefined_groups").append("<button class='toggle'>"+predefinedGroups[i]+"</button>");
                $(".page[data-page='left_selection'] #predefined_groups").append("<button class='toggle'>"+predefinedGroups[i]+"</button>");
            } 

            // Screen Shifting
            $("[data-js-page]").on("touchend", async function(){
                var goal_page = $(this).data("js-page");
                $(".page").removeClass("active");
                $(".page[data-page='"+goal_page+"']").addClass("active");
                
                if (goal_page == 'right_selection') {
                    selectionSide = 'right';
                    console.log("right-side");
                } else if (goal_page == 'left_selection') {
                    selectionSide = 'left';
                    console.log("left-side");
                } else if (goal_page == 'home') {
                    selectionSide = null;
                    generateVis(data)
                    setCountryLabels(data)
                    console.log("home");
                }
            })

            // Toggle Button Logic
            $(".toggle").click(async function() {
                if (selectionSide == 'right') {
                    if ($(this).hasClass('active')) {
                        $(this).removeClass('active')
                        removeItemOnce(rightCountries,$(this).html())
                    } else {
                        $(this).addClass('active')
                        rightCountries.push($(this).html());
                    }
                    console.log(rightCountries)
                    
                } else if (selectionSide == 'left') {
                    if ($(this).hasClass('active')) {
                        $(this).removeClass('active')
                        removeItemOnce(leftCountries,$(this).html())
                    } else {
                        $(this).addClass('active')
                        leftCountries.push($(this).html());
                    }
                    console.log(leftCountries)
                } else {
                    leftCountries.push($(this).html());
                }

                console.log($(this).html());
            })

            // Vis Type Selection
            $(".switch_vis_button .type_button").click(async function() {
                $(".switch_vis_button .type_button").removeClass("active")
                $(this).addClass("active");

                if ($("#bar_graph_button").hasClass('active')) {
                    $("#compare_toggle_button").hide()
                    visType = 'bar'
                } else if ($("#radar_chart_button").hasClass('active')) {
                    $("#compare_toggle_button").show()
                    visType = 'radar'
                }

                generateVis(data)
            })

            // Comparison Type Selection
            $("#compare_toggle_button").click(async function() {
                if (comparisonType == "separate") {
                    comparisonType = 'together';
                    $('#compare_toggle_button').css("background-image", "url('img/expand.png')");  

                } else {
                    comparisonType = 'separate';
                    $('#compare_toggle_button').css("background-image", "url('img/combine.png')");  
                }

                generateVis(data)
                console.log(comparisonType)
            })

            
        });

        async function setCountryLabels(data) {

            $("#right_countries").empty()
            $("#left_countries").empty()

            for (i=0;i<rightCountries.length;i++) {
                $("#right_countries").append("<button class='country_label'>"+rightCountries[i]+"</button>");
            }

            for (i=0;i<leftCountries.length;i++) {
                $("#left_countries").append("<button class='country_label'>"+leftCountries[i]+"</button>");
            }

            $('#right_countries .country_label').mouseover( async function (event) {
                console.log($(this).html())
                tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                var tempArray = []
                tempArray.push($(this).html())
                tempArray = await addGroups(tempArray)

                countryData = generateDataset(data, tempArray)
                profile = "Score: " + countryData.score.toString() + "<br>" 
                                    + countryData.dataset[0].letter + ": " + countryData.dataset[0].frequency + "<br>" 
                                    + countryData.dataset[1].letter + ": " + countryData.dataset[1].frequency + "<br>" 
                                    + countryData.dataset[2].letter + ": " + countryData.dataset[2].frequency + "<br>" 
                                    + countryData.dataset[3].letter + ": " + countryData.dataset[3].frequency + "<br>" 
                                    + countryData.dataset[4].letter + ": " + countryData.dataset[4].frequency + "<br>" 
                                    + countryData.dataset[5].letter + ": " + countryData.dataset[5].frequency

                tooltip.html(profile)
                    .style("left", (event.pageX - 250) + "px")
                    .style("top", (event.pageY) + "px");
            })

            $('#left_countries .country_label').mouseover( async function (event) {
                console.log($(this).html())
                tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                var tempArray = []
                tempArray.push($(this).html())
                tempArray = await addGroups(tempArray)

                countryData = generateDataset(data, tempArray)
                profile = "Score: " + countryData.score.toString() + "<br>" 
                                    + countryData.dataset[0].letter + ": " + countryData.dataset[0].frequency + "<br>" 
                                    + countryData.dataset[1].letter + ": " + countryData.dataset[1].frequency + "<br>" 
                                    + countryData.dataset[2].letter + ": " + countryData.dataset[2].frequency + "<br>" 
                                    + countryData.dataset[3].letter + ": " + countryData.dataset[3].frequency + "<br>" 
                                    + countryData.dataset[4].letter + ": " + countryData.dataset[4].frequency + "<br>" 
                                    + countryData.dataset[5].letter + ": " + countryData.dataset[5].frequency

                tooltip.html(profile)
                    .style("left", (event.pageX + 70) + "px")
                    .style("top", (event.pageY) + "px");
            })

            $('.country_label').mouseout(function () {
                tooltip.transition()
                        .duration(50)
                        .style('opacity', 0);
            })
        }


        async function addGroups(countries) {
            finalCountries = []

            for (i=0;i<countries.length;i++) {
                if (countries[i] == "Top 50") {
                    finalCountries = finalCountries.concat(countriesTop50)
                } else if (countries[i] == "Bottom 50") {
                    finalCountries = finalCountries.concat(countriesBottom50)
                } else if (countries[i] == "Developed") {
                    finalCountries = finalCountries.concat(countriesDeveloped)
                } else if (countries[i] == "Developing") {
                    finalCountries = finalCountries.concat(countriesDeveloping)
                } else if (countries[i] == "Transitioning") {
                    finalCountries = finalCountries.concat(countriesTransition)
                } else if (countries[i] == "North America") {
                    finalCountries = finalCountries.concat(countriesNorthAmerica)
                } else if (countries[i] == "South America") {
                    finalCountries = finalCountries.concat(countriesSouthAmerica)
                } else if (countries[i] == "Asia") {
                    finalCountries = finalCountries.concat(countriesAsia)
                } else if (countries[i] == "Europe") {
                    finalCountries = finalCountries.concat(countriesEurope)
                } else if (countries[i] == 'Africa') {
                    finalCountries = finalCountries.concat(countriesAfrica)
                } else if (countries[i] == "Oceania") {
                    finalCountries = finalCountries.concat(countriesOceania)
                } else if (countries[i] == "World") {
                    finalCountries = finalCountries.concat(countriesListRank)
                } else {
                    finalCountries.push(countries[i])
                }
            }
            return finalCountries
        }

        async function generateVis(data) {

            actualRightCountries = await addGroups(rightCountries)
            actualLeftCountries = await addGroups(leftCountries)

            rightData = generateDataset(data, actualRightCountries)
            leftData = generateDataset(data, actualLeftCountries)

            if (isNaN(rightData.score)) {
                $(".middle_right .score").html("ADD<br>COUNTRIES");
                d3.select("#right_vis svg").remove();
            } else {
                $(".middle_right .score").html(rightData.score.toString());
            }

            if (isNaN(leftData.score)) {
                $(".middle_left .score").html("ADD<br>COUNTRIES");
                d3.select("#left_vis svg").remove();
            } else {
                $(".middle_left .score").html(leftData.score.toString());
            }
            
            

            if (visType == 'radar') {
                if (comparisonType == 'separate') {
                    d3.select("#middle_vis svg").remove();

                    if (leftCountries.length != 0) {
                        generateRadar(leftData, "#left_vis", "blue");
                    }
                        
                    if (rightCountries.length != 0) {
                        generateRadar(rightData, "#right_vis", "red");
                    }
                        
                } else { // together
                    d3.select("#left_vis svg").remove();
                    d3.select("#right_vis svg").remove();
                    if (!(leftCountries.length == 0 && rightCountries.length == 0)) {
                        generateCombinedRadar(leftData, "blue", rightData, "red","#middle_vis");
                    }
                }
                
            } else { // bar
                d3.select("#middle_vis svg").remove();

                if (leftCountries.length != 0) {
                    generateBar(leftData, "#left_vis","blue");
                }
                
                if (rightCountries.length != 0) {
                    generateBar(rightData, "#right_vis","red");
                }
            }
        }

        function removeItemOnce(arr, value) {
            var index = arr.indexOf(value);
            if (index > -1) {
                arr.splice(index, 1);
            }
            return arr;
        }

        function generateDataset(data, chosenCountries) {

            var score = 0;
            var gdp_per_capita = 0;
            var social_support = 0;
            var life_expectancy = 0;
            var freedom = 0;
            var generosity = 0;
            var corruption = 0;

            var filtered_data = data.filter(function(d,i){ return chosenCountries.indexOf(d.Country) >= 0 });
            //console.log(filtered_data);

            for (var i = 0; i < filtered_data.length; i++) {
                score += parseFloat(filtered_data[i].Score);
                gdp_per_capita += parseFloat(filtered_data[i].GDPPerCapita);
                social_support += parseFloat(filtered_data[i].SocialSupport);
                life_expectancy += parseFloat(filtered_data[i].LifeExpectancy);
                freedom += parseFloat(filtered_data[i].Freedom);
                generosity += parseFloat(filtered_data[i].Generosity);
                corruption += parseFloat(filtered_data[i].Corruption);
            }

            score = Math.round((score / filtered_data.length + Number.EPSILON) * 100) / 100;
            gdp_per_capita = Math.round((gdp_per_capita / filtered_data.length + Number.EPSILON) * 100) / 100;
            social_support = Math.round((social_support / filtered_data.length + Number.EPSILON) * 100) / 100;
            life_expectancy = Math.round((life_expectancy / filtered_data.length + Number.EPSILON) * 100) / 100;
            freedom = Math.round((freedom / filtered_data.length + Number.EPSILON) * 100) / 100;
            generosity = Math.round((generosity / filtered_data.length + Number.EPSILON) * 100) / 100;
            corruption = Math.round((corruption / filtered_data.length + Number.EPSILON) * 100) / 100;

            var letterData = [
                {letter: "GDP Per Capita", frequency: gdp_per_capita}, //GDP per capita
                {letter: "Social Support", frequency: social_support}, //Social support
                {letter: "Life Expectancy", frequency: life_expectancy}, //Life expectancy
                {letter: "Freedom", frequency: freedom}, //Freedom
                {letter: "Generosity", frequency: generosity}, //Generosity
                {letter: "Corruption", frequency: corruption} //Corruption
            ];

            //create struct
            var data_struct = {
                score: score,
                dataset: letterData
            };
            console.log(data_struct);
            return data_struct;
        }

        async function generateBar(data, chosenDiv, color){

            d3.select(chosenDiv + " svg").remove();
            
            // establishing variables
            var margin = 50,
            width = 600 - 2 * margin,
            height = 500 - 2 * margin;

            // creating svg
            var svg = d3.select(chosenDiv).append('svg')
            .attr("width", width + 2 * margin)
            .attr("height", height + 2 * margin)
            .attr("transform", "translate(" + margin + ", " + margin + ")")

            var d = data.dataset;
            //console.log(d);

            // scaling
            var xscale = d3.scaleBand()
            .domain(d.map(function(d){ return (d.letter) }))
            .range( [0, width])
            .padding(0.4);

            var yscale = d3.scaleLinear()
            .domain([0, 1.8]) //d3.max(d, function(d){return d.frequency; })
            .range( [height, 0] );
            console.log(d3.max(d, d.frequency));

            // Add X axis
            var x_axis = d3.axisBottom()
            .scale(xscale)

            svg.append("g")
            .attr("transform", "translate(" + margin + "," + height + ")")
            .call(x_axis)
            .attr("class", "xAxis")
            .attr("fill", "white");


            // Add Y axis
            var y_axis = d3.axisLeft()
            .scale(yscale)
            .tickValues([])
            
            svg.append("g")
            .attr("transform", "translate(" + margin + ", 0 )")
            .call(y_axis)
            .attr("class", "yAxis")
            .attr("fill", "white");

            // Add X axis label
            svg.append("text")
            .attr("text-anchor", "middle")
            .attr("x", width/2 + margin)
            .attr("y", height + 40)
            .text("Factor")
            .attr("fill", "white");

            // Add Y axis label
            svg.append("text")
            .attr("text-anchor", "middle")
            .attr("x", -(height/2))
            .attr("y", 0)
            .attr("dy", ".75em")
            .attr("transform", "rotate(-90)")
            .text("Value")
            .attr("fill", "white");

            // Add Bars
            var bars = svg.selectAll(".bar")
            .data(d)
            .enter().append("rect")
            .attr("class", "bar")
            .attr("x", function(d){ return xscale(d.letter) + margin })
            .attr("y", function(d){ return yscale(d.frequency) })
            .attr("height", function(d){ return height - yscale(d.frequency) })
            .attr("width", function(d){ return xscale.bandwidth() })
            .attr("fill", color)
            .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);
                    
                    var ft_name = d.letter

                    var profile = '';

                    if (ft_name == 'Freedom') {
                        profile = 'How satisfied or dissatisfied people are with their freedom to make life decisions.'
                    } else if (ft_name == 'Generosity') {
                        profile = 'How likely people are to have donated money to a charity in the past month.' 
                    } else if (ft_name == 'Corruption') {
                        profile = 'How much corruption is perceived as widespread in the government and businesses.'
                    } else if (ft_name == 'GDP Per Capita') {
                        profile = 'The value of all the goods and services a country produces on a yearly basis divided by the total population.';
                    } else if (ft_name == 'Social Support') {
                        profile = 'How likely people are to have relatives or friends who they can count on in a time of need.';
                    } else if (ft_name == 'Life Expectancy') {
                        profile = 'Average number of healthy years a child at birth is estimated to live calculated by the WHO.'
                    }

                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
                .on("mouseout", function(d,i) {
                    d3.select(this).style("cursor", "default")
                    
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 0);
                })

            svg.append("text")
            .attr("text-anchor", "middle")
            .attr("x", width/2 + margin)
            .attr("y", 15)
            .attr("fill", "white");


        }

        async function generateRadar(data, chosenDiv, color){

            d3.select(chosenDiv + " svg").remove();

            var dataset = data.dataset;
            var score = data.score;

            let radialScale = d3.scaleLinear()
            .domain([0,11])
            .range([0,200]);

            function angleToCoordinate(angle, value){
                let x = Math.cos(angle) * radialScale(value);
                let y = Math.sin(angle) * radialScale(value);
                return {"x": 250 + x, "y": 250 - y};
            }

            function getPathCoordinates(data_point){
                let scale = 57;
                let coordinates = [];
                for (var i = 0; i < data_point.length; i++){
                    let point = data_point[i];
                    let ft_name = point.letter;
                    let angle = (Math.PI / 2) + (2 * Math.PI * i / data_point.length);
                    coordinates.push(angleToCoordinate(angle, (point.frequency * scale / 10)));
                }
                return coordinates;
            }

            let svg = d3.select(chosenDiv).append("svg")
                .attr("width", 500)
                .attr("height", 500);

            for (var i = 0; i < dataset.length; i++) {
                let ft_name = dataset[i].letter;
                let angle = (Math.PI / 2) + (2 * Math.PI * i / dataset.length);
                let line_coordinate = angleToCoordinate(angle, 10);
                let label_coordinate = angleToCoordinate(angle, 10.5);

                //draw axis line
                svg.append("line")
                .attr("x1", 250)
                .attr("y1", 250)
                .attr("x2", line_coordinate.x)
                .attr("y2", line_coordinate.y)
                .attr("stroke","white");

                //draw axis label
                svg.append("text")
                .attr("x", label_coordinate.x - 5)
                .attr("y", label_coordinate.y + 5)
                .text(ft_name)
                .attr("fill", "white")
                .attr("text-anchor","middle")
                .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                    console.log(ft_name)
                    
                    var profile = '';

                    if (ft_name == 'Freedom') {
                        profile = 'How satisfied or dissatisfied people are with their freedom to make life decisions.'
                    } else if (ft_name == 'Generosity') {
                        profile = 'How likely people are to have donated money to a charity in the past month.' 
                    } else if (ft_name == 'Corruption') {
                        profile = 'How much corruption is perceived as widespread in the government and businesses.'
                    } else if (ft_name == 'GDP Per Capita') {
                        profile = 'The value of all the goods and services a country produces on a yearly basis divided by the total population.';
                    } else if (ft_name == 'Social Support') {
                        profile = 'How likely people are to have relatives or friends who they can count on in a time of need.';
                    } else if (ft_name == 'Life Expectancy') {
                        profile = 'Average number of healthy years a child at birth is estimated to live calculated by the WHO.'
                    }

                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
                .on("mouseout", function(d,i) {
                    d3.select(this).style("cursor", "default")
                    
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 0);
                }) 
            }

            let line = d3.line()
                .x(d => d.x)
                .y(d => d.y);

            let coordinates = getPathCoordinates(dataset);

            //draw the path element
            svg.append("path")
            .datum(coordinates)
            .attr("d",line)
            .attr("fill", color)
            .attr("stroke-opacity", 1)
            .attr("opacity", .4)
            .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                    var profile = "Score: " + score.toString() + "<br>" 
                                    + dataset[0].letter + ": " + dataset[0].frequency + "<br>" 
                                    + dataset[1].letter + ": " + dataset[1].frequency + "<br>" 
                                    + dataset[2].letter + ": " + dataset[2].frequency + "<br>" 
                                    + dataset[3].letter + ": " + dataset[3].frequency + "<br>" 
                                    + dataset[4].letter + ": " + dataset[4].frequency + "<br>" 
                                    + dataset[5].letter + ": " + dataset[5].frequency
                    
                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
            .on("mouseout", function(d,i) {
                d3.select(this).style("cursor", "default")
                
                tooltip.transition()
                    .duration(50)
                    .style('opacity', 0);
            }); 

        }

        async function generateCombinedRadar(data1, color1, data2, color2, chosenDiv){

            d3.select(chosenDiv + " svg").remove();
            
            var dataset1 = data1.dataset;
            var dataset2 = data2.dataset;

            var score1 = data1.score;
            var score2 = data2.score;

            let radialScale = d3.scaleLinear()
            .domain([0,11])
            .range([0,200]);

            function angleToCoordinate(angle, value){
                let x = Math.cos(angle) * radialScale(value);
                let y = Math.sin(angle) * radialScale(value);
                return {"x": 250 + x, "y": 250 - y};
            }

            function getPathCoordinates(data_point){
                let scale = 57;
                let coordinates = [];
                for (var i = 0; i < data_point.length; i++){
                    let point = data_point[i];
                    let ft_name = point.letter;
                    let angle = (Math.PI / 2) + (2 * Math.PI * i / data_point.length);
                    coordinates.push(angleToCoordinate(angle, (point.frequency * scale / 10)));
                }
                return coordinates;
            }

            let svg = d3.select(chosenDiv).append("svg")
                .attr("width", 500)
                .attr("height", 500);

            for (var i = 0; i < dataset1.length; i++) {
                let ft_name = dataset1[i].letter;
                let angle = (Math.PI / 2) + (2 * Math.PI * i / dataset1.length);
                let line_coordinate = angleToCoordinate(angle, 10);
                let label_coordinate = angleToCoordinate(angle, 10.5);

                //draw axis line
                svg.append("line")
                .attr("x1", 250)
                .attr("y1", 250)
                .attr("x2", line_coordinate.x)
                .attr("y2", line_coordinate.y)
                .attr("stroke","white");

                //draw axis label
                svg.append("text")
                .attr("x", label_coordinate.x - 5)
                .attr("y", label_coordinate.y + 5)
                .text(ft_name)
                .attr("fill", "white")
                .attr("text-anchor","middle")
                .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                    console.log(ft_name)
                    
                    var profile = '';

                    if (ft_name == 'Freedom') {
                        profile = 'How satisfied or dissatisfied people are with their freedom to make life decisions.'
                    } else if (ft_name == 'Generosity') {
                        profile = 'How likely people are to have donated money to a charity in the past month.' 
                    } else if (ft_name == 'Corruption') {
                        profile = 'How much corruption is perceived as widespread in the government and businesses.'
                    } else if (ft_name == 'GDP Per Capita') {
                        profile = 'The value of all the goods and services a country produces on a yearly basis divided by the total population.';
                    } else if (ft_name == 'Social Support') {
                        profile = 'How likely people are to have relatives or friends who they can count on in a time of need.';
                    } else if (ft_name == 'Life Expectancy') {
                        profile = 'Average number of healthy years a child at birth is estimated to live calculated by the WHO.'
                    }

                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
                .on("mouseout", function(d,i) {
                    d3.select(this).style("cursor", "default")
                    
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 0);
                }) 
            }

            let line = d3.line()
                .x(d => d.x)
                .y(d => d.y);

            let coordinates1 = getPathCoordinates(dataset1);

            //draw the path element
            svg.append("path")
            .datum(coordinates1)
            .attr("d",line)
            .attr("fill", color1)
            .attr("stroke-opacity", 1)
            .attr("opacity", .5)
            .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                    var profile = "Score: " + score1.toString() + "<br>" 
                                + dataset1[0].letter + ": " + dataset1[0].frequency + "<br>" 
                                + dataset1[1].letter + ": " + dataset1[1].frequency + "<br>" 
                                + dataset1[2].letter + ": " + dataset1[2].frequency + "<br>" 
                                + dataset1[3].letter + ": " + dataset1[3].frequency + "<br>" 
                                + dataset1[4].letter + ": " + dataset1[4].frequency + "<br>" 
                                + dataset1[5].letter + ": " + dataset1[5].frequency
                    
                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
            .on("mouseout", function(d,i) {
                d3.select(this).style("cursor", "default")
                
                tooltip.transition()
                    .duration(50)
                    .style('opacity', 0);
            }); 

            let coordinates2 = getPathCoordinates(dataset2);

            //draw the path element
            svg.append("path")
            .datum(coordinates2)
            .attr("d",line)
            .attr("fill", color2)
            .attr("stroke-opacity", 1)
            .attr("opacity", .5)
            .on("mouseover", function (d,i) {
                    d3.select(this).style("cursor", "pointer")
                    tooltip.transition()
                        .duration(50)
                        .style('opacity', 1);

                    var profile = "Score: " + score2.toString() + "<br>" 
                                    + dataset2[0].letter + ": " + dataset2[0].frequency + "<br>" 
                                    + dataset2[1].letter + ": " + dataset2[1].frequency + "<br>" 
                                    + dataset2[2].letter + ": " + dataset2[2].frequency + "<br>" 
                                    + dataset2[3].letter + ": " + dataset2[3].frequency + "<br>" 
                                    + dataset2[4].letter + ": " + dataset2[4].frequency + "<br>" 
                                    + dataset2[5].letter + ": " + dataset2[5].frequency
                    
                    tooltip.html(profile)
                        .style("left", (d3.event.pageX - 40) + "px")
                        .style("top", (d3.event.pageY - 100) + "px");
                })
            .on("mouseout", function(d,i) {
                d3.select(this).style("cursor", "default")
                
                tooltip.transition()
                    .duration(50)
                    .style('opacity', 0);
            }); 
        }
    </script>
    
</body>


</html>